# Given a variable V, the following code will compute a variable R
# which keeps the value of V as long as it's in +/-5%, updating when
# it's out of such a boundary.
#
# This test ensures that any single gap in V will cause R to cease.
#
"program=
RecSet[
    NumericDouble[],
    R,
    Scalar[
        Case[
            !Defined[PreviousStop[V, Start]],
            V,

            Defined[PreviousStop[R, Start]]
            && PreviousStop[R, Start] == Start,
            If[
                Abs[V / PreviousValue[R, Start] - 1] > 0.1000000001,
                V,
                PreviousValue[R, Start]
            ]
        ],
        IntervalOf[V]
    ]
]";;;
timeZone=Europe/Rome;;;
startTime=01/01/2015 00:00;;;
stopTime=01/01/2016 00:00;;;
data;;;
V;01/01/2015 00:00;02/01/2015 00:00;1
V;02/01/2015 00:00;03/01/2015 00:00;1
V;03/01/2015 00:00;04/01/2015 00:00;2
V;04/01/2015 00:00;05/01/2015 00:00;3
V;05/01/2015 00:00;06/01/2015 00:00;4
V;06/01/2015 00:00;07/01/2015 00:00;5
V;07/01/2015 00:00;08/01/2015 00:00;6
V;08/01/2015 00:00;09/01/2015 00:00;7
V;09/01/2015 00:00;10/01/2015 00:00;8
V;10/01/2015 00:00;11/01/2015 00:00;9
V;11/01/2015 00:00;12/01/2015 00:00;10
V;12/01/2015 00:00;13/01/2015 00:00;11
V;13/01/2015 00:00;14/01/2015 00:00;12
V;14/01/2015 00:00;15/01/2015 00:00;13
V;15/01/2015 00:00;16/01/2015 00:00;14
V;16/01/2015 00:00;17/01/2015 00:00;15
V;17/01/2015 00:00;18/01/2015 00:00;16
V;18/01/2015 00:00;19/01/2015 00:00;17
V;19/01/2015 00:00;20/01/2015 00:00;18
V;20/01/2015 00:00;21/01/2015 00:00;19
V;21/01/2015 00:00;22/01/2015 00:00;20
V;22/01/2015 00:00;23/01/2015 00:00;21
V;23/01/2015 00:00;24/01/2015 00:00;22
V;24/01/2015 00:00;25/01/2015 00:00;23
V;25/01/2015 00:00;26/01/2015 00:00;24
V;26/01/2015 00:00;27/01/2015 00:00;25
V;27/01/2015 00:00;28/01/2015 00:00;26
V;28/01/2015 00:00;29/01/2015 00:00;27
V;29/01/2015 00:00;30/01/2015 00:00;28
V;30/01/2015 00:00;31/01/2015 00:00;29
V;31/01/2015 00:00;01/02/2015 00:00;30
V;01/02/2015 00:00;02/02/2015 00:00;31
V;02/02/2015 00:00;03/02/2015 00:00;32
V;03/02/2015 00:00;04/02/2015 00:00;33
V;04/02/2015 00:00;05/02/2015 00:00;34
V;05/02/2015 00:00;06/02/2015 00:00;35
V;06/02/2015 00:00;07/02/2015 00:00;36
V;07/02/2015 00:00;08/02/2015 00:00;37
V;08/02/2015 00:00;09/02/2015 00:00;38
V;09/02/2015 00:00;10/02/2015 00:00;39
V;10/02/2015 00:00;11/02/2015 00:00;40
V;11/02/2015 00:00;12/02/2015 00:00;41
V;12/02/2015 00:00;13/02/2015 00:00;42
V;13/02/2015 00:00;14/02/2015 00:00;43
V;14/02/2015 00:00;15/02/2015 00:00;44
V;15/02/2015 00:00;16/02/2015 00:00;45
V;16/02/2015 00:00;17/02/2015 00:00;46
V;17/02/2015 00:00;18/02/2015 00:00;47
V;18/02/2015 00:00;19/02/2015 00:00;48
V;19/02/2015 00:00;20/02/2015 00:00;49
V;20/02/2015 00:00;21/02/2015 00:00;50
V;21/02/2015 00:00;22/02/2015 00:00;51
V;22/02/2015 00:00;23/02/2015 00:00;52
V;23/02/2015 00:00;24/02/2015 00:00;53
V;24/02/2015 00:00;25/02/2015 00:00;54
V;25/02/2015 00:00;26/02/2015 00:00;55
V;26/02/2015 00:00;27/02/2015 00:00;56
V;27/02/2015 00:00;28/02/2015 00:00;57
V;28/02/2015 00:00;01/03/2015 00:00;58
V;01/03/2015 00:00;02/03/2015 00:00;59
V;02/03/2015 00:00;03/03/2015 00:00;60
V;03/03/2015 00:00;04/03/2015 00:00;61
V;04/03/2015 00:00;05/03/2015 00:00;62
V;05/03/2015 00:00;06/03/2015 00:00;63
V;06/03/2015 00:00;07/03/2015 00:00;64
V;07/03/2015 00:00;08/03/2015 00:00;65
V;08/03/2015 00:00;09/03/2015 00:00;66
V;09/03/2015 00:00;10/03/2015 00:00;67
V;10/03/2015 00:00;11/03/2015 00:00;68
# GAP
V;12/03/2015 00:00;13/03/2015 00:00;70
V;13/03/2015 00:00;14/03/2015 00:00;71
V;14/03/2015 00:00;15/03/2015 00:00;72
V;15/03/2015 00:00;16/03/2015 00:00;73
V;16/03/2015 00:00;17/03/2015 00:00;74
V;17/03/2015 00:00;18/03/2015 00:00;75
V;18/03/2015 00:00;19/03/2015 00:00;76
V;19/03/2015 00:00;20/03/2015 00:00;77
V;20/03/2015 00:00;21/03/2015 00:00;78
V;21/03/2015 00:00;22/03/2015 00:00;79
V;22/03/2015 00:00;23/03/2015 00:00;80
V;23/03/2015 00:00;24/03/2015 00:00;81
V;24/03/2015 00:00;25/03/2015 00:00;82
V;25/03/2015 00:00;26/03/2015 00:00;83
V;26/03/2015 00:00;27/03/2015 00:00;84
V;27/03/2015 00:00;28/03/2015 00:00;85
V;28/03/2015 00:00;29/03/2015 00:00;86
V;29/03/2015 00:00;30/03/2015 00:00;87
V;30/03/2015 00:00;31/03/2015 00:00;88
V;31/03/2015 00:00;01/04/2015 00:00;89

### Results

R*;01/01/2015 00:00;02/01/2015 00:00;1
R*;02/01/2015 00:00;03/01/2015 00:00;1
R*;03/01/2015 00:00;04/01/2015 00:00;2
R*;04/01/2015 00:00;05/01/2015 00:00;3
R*;05/01/2015 00:00;06/01/2015 00:00;4
R*;06/01/2015 00:00;07/01/2015 00:00;5
R*;07/01/2015 00:00;08/01/2015 00:00;6
R*;08/01/2015 00:00;09/01/2015 00:00;7
R*;09/01/2015 00:00;10/01/2015 00:00;8
R*;10/01/2015 00:00;11/01/2015 00:00;9
R*;11/01/2015 00:00;12/01/2015 00:00;10
R*;12/01/2015 00:00;13/01/2015 00:00;10
R*;13/01/2015 00:00;14/01/2015 00:00;12
R*;14/01/2015 00:00;15/01/2015 00:00;12
R*;15/01/2015 00:00;16/01/2015 00:00;14
R*;16/01/2015 00:00;17/01/2015 00:00;14
R*;17/01/2015 00:00;18/01/2015 00:00;16
R*;18/01/2015 00:00;19/01/2015 00:00;16
R*;19/01/2015 00:00;20/01/2015 00:00;18
R*;20/01/2015 00:00;21/01/2015 00:00;18
R*;21/01/2015 00:00;22/01/2015 00:00;20
R*;22/01/2015 00:00;23/01/2015 00:00;20
R*;23/01/2015 00:00;24/01/2015 00:00;20
R*;24/01/2015 00:00;25/01/2015 00:00;23
R*;25/01/2015 00:00;26/01/2015 00:00;23
R*;26/01/2015 00:00;27/01/2015 00:00;23
R*;27/01/2015 00:00;28/01/2015 00:00;26
R*;28/01/2015 00:00;29/01/2015 00:00;26
R*;29/01/2015 00:00;30/01/2015 00:00;26
R*;30/01/2015 00:00;31/01/2015 00:00;29
R*;31/01/2015 00:00;01/02/2015 00:00;29
R*;01/02/2015 00:00;02/02/2015 00:00;29
R*;02/02/2015 00:00;03/02/2015 00:00;32
R*;03/02/2015 00:00;04/02/2015 00:00;32
R*;04/02/2015 00:00;05/02/2015 00:00;32
R*;05/02/2015 00:00;06/02/2015 00:00;32
R*;06/02/2015 00:00;07/02/2015 00:00;36
R*;07/02/2015 00:00;08/02/2015 00:00;36
R*;08/02/2015 00:00;09/02/2015 00:00;36
R*;09/02/2015 00:00;10/02/2015 00:00;36
R*;10/02/2015 00:00;11/02/2015 00:00;40
R*;11/02/2015 00:00;12/02/2015 00:00;40
R*;12/02/2015 00:00;13/02/2015 00:00;40
R*;13/02/2015 00:00;14/02/2015 00:00;40
R*;14/02/2015 00:00;15/02/2015 00:00;40
R*;15/02/2015 00:00;16/02/2015 00:00;45
R*;16/02/2015 00:00;17/02/2015 00:00;45
R*;17/02/2015 00:00;18/02/2015 00:00;45
R*;18/02/2015 00:00;19/02/2015 00:00;45
R*;19/02/2015 00:00;20/02/2015 00:00;45
R*;20/02/2015 00:00;21/02/2015 00:00;50
R*;21/02/2015 00:00;22/02/2015 00:00;50
R*;22/02/2015 00:00;23/02/2015 00:00;50
R*;23/02/2015 00:00;24/02/2015 00:00;50
R*;24/02/2015 00:00;25/02/2015 00:00;50
R*;25/02/2015 00:00;26/02/2015 00:00;50
R*;26/02/2015 00:00;27/02/2015 00:00;56
R*;27/02/2015 00:00;28/02/2015 00:00;56
R*;28/02/2015 00:00;01/03/2015 00:00;56
R*;01/03/2015 00:00;02/03/2015 00:00;56
R*;02/03/2015 00:00;03/03/2015 00:00;56
R*;03/03/2015 00:00;04/03/2015 00:00;56
R*;04/03/2015 00:00;05/03/2015 00:00;62
R*;05/03/2015 00:00;06/03/2015 00:00;62
R*;06/03/2015 00:00;07/03/2015 00:00;62
R*;07/03/2015 00:00;08/03/2015 00:00;62
R*;08/03/2015 00:00;09/03/2015 00:00;62
R*;09/03/2015 00:00;10/03/2015 00:00;62
R*;10/03/2015 00:00;11/03/2015 00:00;62
